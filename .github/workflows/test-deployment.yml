name: Test Deploy Versioned Pages

on:
  pull_request:
    types: [opened, synchronize, closed]
  push:
    branches:
      - main

permissions:
  contents: write
  pull-requests: write
  pages: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
        contents: write  # âœ… Required for pushing to gh-pages
        pages: write
        id-token: write    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name:  Check If Token is Passed

        run: |
          if [ -z "${{ vars.DEPLOY_PRIVATE_KEY }}" ]; then
            echo "âŒ ERROR: vars.DEPLOY_PRIVATE_KEY is empty!"
            exit 1
          else
            echo "âœ… vars.DEPLOY_PRIVATE_KEY is available."
          fi        

      - name: Start SSH Agent and Add Key
        env:
            SSH_PRIVATE_KEY: ${{ vars.DEPLOY_PRIVATE_KEY }}
        run: |
            eval "$(ssh-agent -s)"
            echo "$SSH_PRIVATE_KEY" | ssh-add -
            ssh-keyscan github.com >> ~/.ssh/known_hosts

      - name: Run Custom Deploy Action ðŸš€
        uses: ./.github/actions/deploy-versioned-pages
        with:
          source_folder: "docs/build"  # Change to an actual test folder
          versions_file: "versions"
          create_comment: "true"
          gh_token: $SSH_AUTH_SOCK 

